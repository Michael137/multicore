1. more robust threadId generation and indexing
2. implement compat/barrier
3. implement iterator interface for registers
